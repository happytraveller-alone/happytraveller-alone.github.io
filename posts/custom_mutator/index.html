<!doctype html><html lang=zh-Hans x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>变异器生成 | 小谢同学的修行小屋</title>
<link rel=canonical href=https://happytraveller-alone.github.io/posts/custom_mutator/><meta name=author content="YuanFeng Xie"><meta name=description content="本次博文用于梳理AFLplusplus的框架，Mutator在AFL及AFLplusplus中的定义，Custom Mutator在AFLplusplus中的定义，以及利用LLM进行Mutator Generation遇到的挑战。
"><meta name=keywords content="Fuzz"><meta name=generator content="Hugo 0.139.3"><meta property="og:url" content="https://happytraveller-alone.github.io/posts/custom_mutator/"><meta property="og:site_name" content="小谢同学的修行小屋"><meta property="og:title" content="变异器生成"><meta property="og:description" content="本次博文用于梳理AFLplusplus的框架，Mutator在AFL及AFLplusplus中的定义，Custom Mutator在AFLplusplus中的定义，以及利用LLM进行Mutator Generation遇到的挑战。"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-25T09:29:29+08:00"><meta property="article:modified_time" content="2024-12-08T07:40:13+00:00"><meta property="article:tag" content="Fuzz"><meta name=twitter:card content="summary"><meta name=twitter:title content="变异器生成"><meta name=twitter:description content="本次博文用于梳理AFLplusplus的框架，Mutator在AFL及AFLplusplus中的定义，Custom Mutator在AFLplusplus中的定义，以及利用LLM进行Mutator Generation遇到的挑战。"><link rel=stylesheet href=/css/output.min.css><link rel=stylesheet href=/css/code-wrap.css><link rel=stylesheet href=/css/syntax.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav class="mt-4 lg:mt-8 py-4"><div class="container flex justify-between max-w-[65ch] mx-auto px-4 md:px-0"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title=翻转一下！><div class="h-10 rounded-full"><img src=/images/logo.png alt=小谢同学的修行小屋></div></div><div><a href=https://happytraveller-alone.github.io/ class="text-lg font-semibold cursor-pointer">小谢同学的修行小屋</a><div class="text-base-content/60 text-sm">无人扶我青云志，我自踏雪至山巅</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=关于我><ion-icon name=information-circle></ion-icon>关于我</div></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=归档><ion-icon name=archive></ion-icon>归档</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title=所有分类><ion-icon name=grid></ion-icon>所有分类</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title=所有标签><ion-icon name=pricetags></ion-icon>所有标签</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=关于我>关于我</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/posts title=归档><ion-icon class=group-hover:text-primary-content name=archive></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/categories title=所有分类><ion-icon class=group-hover:text-primary-content name=grid></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/tags title=所有标签><ion-icon class=group-hover:text-primary-content name=pricetags></ion-icon></a></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="mt-4 px-4"><div><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="变异器生成"><meta itemprop=description content="本次博文用于梳理AFLplusplus的框架，Mutator在AFL及AFLplusplus中的定义，Custom Mutator在AFLplusplus中的定义，以及利用LLM进行Mutator Generation遇到的挑战。"><meta itemprop=datePublished content="2024-10-25T09:29:29+08:00"><meta itemprop=dateModified content="2024-12-08T07:40:13+00:00"><meta itemprop=wordCount content="988"><meta itemprop=keywords content="Fuzz"><header><h1 itemprop=headline>变异器生成</h1><p class=text-sm>星期五, 10月 25, 2024
| <span>2分钟阅读</span>
| <span>更新于
星期日, 12月 8, 2024</span></p><div class="flex justify-between"><div class="flex items-center"><div class="avatar mr-1"><div class="w-8 rounded-full"><img class=my-0 src=/images/logo.jfif alt="YuanFeng Xie"></div></div><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>YuanFeng Xie</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=%e5%8f%98%e5%bc%82%e5%99%a8%e7%94%9f%e6%88%90&amp;url=https://happytraveller-alone.github.io/posts/custom_mutator/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://happytraveller-alone.github.io/posts/custom_mutator/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=%e5%8f%98%e5%bc%82%e5%99%a8%e7%94%9f%e6%88%90%20https://happytraveller-alone.github.io/posts/custom_mutator/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><p>本次博文用于梳理AFLplusplus的框架，Mutator在AFL及AFLplusplus中的定义，Custom Mutator在AFLplusplus中的定义，以及利用LLM进行Mutator Generation遇到的挑战。</p><h2 id=模糊测试框架>模糊测试框架</h2><h2 id=mutator的定义>Mutator的定义</h2><blockquote class="dream-alert note"><p class=heading><ion-icon name=information-circle-outline></ion-icon>AFL中对于Mutator的定义</p><p>Definition in AFL: Repeatedly mutate the file using a balanced and well-researched variety of traditional fuzzing strategies. The mutator operates as part of AFL&rsquo;s instrumentation-guided genetic algorithm to explore new program states. When mutations result in new state transitions (detected through edge coverage), the mutated outputs are added to the fuzzing queue for further testing, as described in this sequence from the document.</p></blockquote><p>AFL中没有对于Mutator的明确定义，而是对Mutation进行了定义，即对目标文件内容进行修改，修改操作可以包括添加，删除，替换等比特级别的操作</p><blockquote class="dream-alert note"><p class=heading><ion-icon name=information-circle-outline></ion-icon>AFL++中对于Custom Mutator的定义</p><p>Custom mutators enhance and alter the mutation strategies of AFL++. There are different types of custom mutators for different purposes:
Grammar-agnostic: &ldquo;./autotokens you find a token-level fuzzer that does not need to know anything about the grammar of an input as long as it is in ascii and allows whitespace&rdquo;；Grammar-based: &ldquo;atnwalk and gramatron are grammar custom mutators&rdquo;；Protocol-specific: As shown in the &ldquo;libprotobuf Mutators&rdquo; section</p></blockquote><p>Custom Mutator是对AFL原始Mutator的一种增强，使变异操作不局限于比特级别，而是扩展到与输入语法相关的字段级，结构级修改变异，使修改后的内容语法正确性更高。</p><h2 id=mutator-generation>Mutator Generation</h2><p><img src=total.svg alt></p><p>Mutator的Generation划分为两个部分，一个是Mutation Strategy的生成，一个是Mutation Oracle的生成。利用从RFC中抽取出来的Specification Requirement进行规则分类和匹配，将构造消息约束和处理消息约束进行配对。如下图所示，Msg Construction SR中的消息构造规则描述PSK字段应当置于Extension序列中的最后一个。</p><p><img src=RunningExample.png alt>
<img src=mutation_detailed.svg alt></p><p>为了确保Mutation Strategy Generation执行结果即Msg Mutation Exec Code的正确性，将Mutation Strategy Generation的执行过程，分拆成三个部分，分别为约束违反生成，变异描述生成，变异代码生成。</p><ul><li>约束违反生成：消息构造规则作为输入，输出违反规则约束的测试指导策略，图片展示测试策略为将PSK扩展置于其它扩展之前</li><li>变异描述生成：构造违反描述作为输入，输出报文变异指导自然语言描述，图片展示自然描述为将PSK和supported_versions扩展顺序进行交换</li><li>变异代码生成：报文变异指导作为输入，输出报文变异代码，图片展示最终的变异代码为一个API调用。</li></ul></article></div></div><footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12"><div><p>© 2024 小谢同学的修行小屋</p><p class=text-sm>🌱
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="max-w-[65ch] mt-8 mx-auto px-4"><div><div class="mb-4 text-lg font-medium">关于我</div><div class="prose dark:prose-invert"><p><figure><img src=/resume/profile2.png width=100></figure>一名喜欢RUST的菜鸟程序员</p><h4 id=教育背景研二在读>教育背景（研二在读）</h4><ul><li>2019.09 - 2023.06 天津大学 · 智能与计算学部 · 网络安全专业 · 全日制 · 本科</li><li>2023.09 - 2026.06 天津大学 · 智能与计算学部 · 电子信息专业 · 全日制 · 硕士研究生</li></ul></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">浏览器漏洞挖掘项目</div><div class="prose dark:prose-invert"><p><strong>V8引擎的模糊测试工具改进</strong></p><p>时间：2021.09-2022.04</p><p>内容：聚焦于优化JavaScript引擎的测试方法。研究团队基于SOAT改进部署了V8引擎测试环境，并通过分析测例覆盖率和已知CVE，优化了测试流程。</p><p>成果：成功捕获了一个谷歌引擎的<a href="https://bugs.chromium.org/p/v8/issues/detail?id=12563">逻辑漏洞</a>，获得了修复反馈</p><p><strong>JS引擎WASM模块漏洞挖掘研究</strong></p><p>时间：2023.11-2024.4</p><p>内容：阅读标准手动编写了WASM语法规则，调研了主流JS引擎的WASM支持情况，并基于V8构建了WASM二进制框架。</p><p>成果：<a href=https://github.com/happytraveller-alone/antlr_wat/tree/main/wat_grammar_check_java>语法规则</a>、调研报告和<a href=https://github.com/happytraveller-alone/antlr_wat/tree/main/wasm_domato>二进制构建框架</a>，成功捕获<a href="https://bugs.webkit.org/show_bug.cgi?id=271030">特性缺陷</a>并得到修复</p></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">数据库缺陷研究项目</div><div class="prose dark:prose-invert"><p><strong>关系型数据库缺陷的实证研究</strong></p><p>时间：2022.12-2023.11</p><p>内容：通过构建统一的数据库逻辑框架，系统收集并分析了大量数据库缺陷。对777个缺陷进行了深入分析，特别聚焦SQL数据类型问题，并据此改进了模糊测试方法。</p><p>成果：构建<a href=https://github.com/sqlttest/SQLT/blob/main/dataset.xlsx>缺陷数据集</a>, 开发<a href=https://github.com/sqlttest/SQLT>SQLT测试框架</a>。</p></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">网络协议漏洞挖掘项目</div><div class="prose dark:prose-invert"><p><strong>基于 RFC的 SSL/TLS模糊测试</strong></p><p>时间：2024.4 – today</p><p>内容：梳理TLS协议模糊测试的相关工作，关注基于状态机的网络协议模糊测试方法。复现历史漏洞，了解TLS报文结构，追溯相关漏洞代码。分析RFC文档，提取字段约束，构建状态转移范式，并据此完善了TLS协议的有限状态机模型。</p><p>成果：完成相关工作调研, 漏洞复现报告, <strong>状态范式数据集</strong></p></div></div><div class="divider divider-vertical"></div></div></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=/js/main.min.js></script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script></body></html>