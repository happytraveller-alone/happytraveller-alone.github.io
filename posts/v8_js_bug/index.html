<!doctype html><html lang=zh-Hans x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>V8缺陷回看 | 小谢同学的修行小屋</title>
<link rel=canonical href=https://happytraveller-alone.github.io/posts/v8_js_bug/><meta name=author content="YuanFeng Xie"><meta name=description content="本文针对在V8 JavaScript引擎中发现的一个缺陷进行说明。
缺陷通过使用Superion工具进行模糊测试（fuzzing）而发现的。Superion是一个专门用于JavaScript引擎模糊测试的工具，它能够生成大量的JavaScript测试样例，这些样例旨在探测引擎中可能存在的漏洞或异常行为。
"><meta name=keywords content="V8_bug"><meta name=generator content="Hugo 0.136.4"><meta property="og:url" content="https://happytraveller-alone.github.io/posts/v8_js_bug/"><meta property="og:site_name" content="小谢同学的修行小屋"><meta property="og:title" content="V8缺陷回看"><meta property="og:description" content="本文针对在V8 JavaScript引擎中发现的一个缺陷进行说明。
缺陷通过使用Superion工具进行模糊测试（fuzzing）而发现的。Superion是一个专门用于JavaScript引擎模糊测试的工具，它能够生成大量的JavaScript测试样例，这些样例旨在探测引擎中可能存在的漏洞或异常行为。"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-28T20:52:35+08:00"><meta property="article:modified_time" content="2024-10-23T07:05:01+00:00"><meta property="article:tag" content="V8_bug"><meta name=twitter:card content="summary"><meta name=twitter:title content="V8缺陷回看"><meta name=twitter:description content="本文针对在V8 JavaScript引擎中发现的一个缺陷进行说明。
缺陷通过使用Superion工具进行模糊测试（fuzzing）而发现的。Superion是一个专门用于JavaScript引擎模糊测试的工具，它能够生成大量的JavaScript测试样例，这些样例旨在探测引擎中可能存在的漏洞或异常行为。"><link rel=stylesheet href=/css/output.min.css><link rel=stylesheet href=/css/code-wrap.css><link rel=stylesheet href=/css/syntax.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav class="mt-4 lg:mt-8 py-4"><div class="container flex justify-between max-w-[65ch] mx-auto px-4 md:px-0"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title=翻转一下！><div class="h-10 rounded-full"><img src=/images/logo.png alt=小谢同学的修行小屋></div></div><div><a href=https://happytraveller-alone.github.io/ class="text-lg font-semibold cursor-pointer">小谢同学的修行小屋</a><div class="text-base-content/60 text-sm">无人扶我青云志，我自踏雪至山巅</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=关于我><ion-icon name=information-circle></ion-icon>关于我</div></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=归档><ion-icon name=archive></ion-icon>归档</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title=所有分类><ion-icon name=grid></ion-icon>所有分类</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title=所有标签><ion-icon name=pricetags></ion-icon>所有标签</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=关于我>关于我</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/posts title=归档><ion-icon class=group-hover:text-primary-content name=archive></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/categories title=所有分类><ion-icon class=group-hover:text-primary-content name=grid></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/tags title=所有标签><ion-icon class=group-hover:text-primary-content name=pricetags></ion-icon></a></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="mt-4 px-4"><div><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="V8缺陷回看"><meta itemprop=description content="本文针对在V8 JavaScript引擎中发现的一个缺陷进行说明。
缺陷通过使用Superion工具进行模糊测试（fuzzing）而发现的。Superion是一个专门用于JavaScript引擎模糊测试的工具，它能够生成大量的JavaScript测试样例，这些样例旨在探测引擎中可能存在的漏洞或异常行为。"><meta itemprop=datePublished content="2024-09-28T20:52:35+08:00"><meta itemprop=dateModified content="2024-10-23T07:05:01+00:00"><meta itemprop=wordCount content="1109"><meta itemprop=keywords content="V8_bug"><header><h1 itemprop=headline>V8缺陷回看</h1><p class=text-sm>星期六, 9月 28, 2024
| <span>3分钟阅读</span>
| <span>更新于
星期三, 10月 23, 2024</span></p><div class="flex justify-between"><div class="flex items-center"><div class="avatar mr-1"><div class="w-8 rounded-full"><img class=my-0 src=/images/logo.jfif alt="YuanFeng Xie"></div></div><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>YuanFeng Xie</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=V8%e7%bc%ba%e9%99%b7%e5%9b%9e%e7%9c%8b&amp;url=https://happytraveller-alone.github.io/posts/v8_js_bug/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://happytraveller-alone.github.io/posts/v8_js_bug/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=V8%e7%bc%ba%e9%99%b7%e5%9b%9e%e7%9c%8b%20https://happytraveller-alone.github.io/posts/v8_js_bug/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><p>本文针对在V8 JavaScript引擎中发现的一个缺陷进行说明。</p><p>缺陷通过使用Superion工具进行模糊测试（fuzzing）而发现的。Superion是一个专门用于JavaScript引擎模糊测试的工具，它能够生成大量的JavaScript测试样例，这些样例旨在探测引擎中可能存在的漏洞或异常行为。</p><p>在使用Superion工具收集的JavaScript测试样例中，有一些特定的代码片段在V8引擎上运行时触发了这个缺陷。V8是Google开发的开源JavaScript引擎，广泛应用于Chrome浏览器和Node.js运行时环境中。</p><p>该缺陷的详细内容可在Chromium项目的缺陷追踪系统中查看，具体链接为</p><p><a href="https://bugs.chromium.org/p/v8/issues/detail?id=12563">缺陷报告</a>。</p><h3 id=漏洞成因解析>漏洞成因解析</h3><ul><li>原文：The else branch of of BuildPrivateBrandCheck is missing a RegisterAllocationScope, so calls of optional-chained private methods with arguments is violating the bytecode generator&rsquo;s regalloc invariants.</li><li>问题所在：
在处理带参数的可选链私有方法调用时，引擎的某个分支（else分支）缺少了正确的寄存器分配作用域。<ul><li>私有品牌检查（Private Brand Check）：在JavaScript中，私有方法（如我们之前例子中的 #控制中心）需要进行一种特殊的检查，称为"私有品牌检查"。这就像确认某人是否有权限进入一个私人俱乐部。</li><li>可选链（Optional Chaining）：可选链（?.）允许我们安全地访问可能不存在的属性或方法。这就像在敲门之前先确认房子里有人。</li><li>寄存器分配作用域（Register Allocation Scope）：这是V8引擎内部用于管理资源（寄存器）的机制。可以将其想象为临时工作区，引擎在这里处理和储存计算过程中的中间结果。</li></ul></li></ul><h3 id=漏洞形象化说明>漏洞形象化说明</h3><ul><li>想象一个高级餐厅的厨房：<ul><li>私有方法就像特殊的秘方菜品。</li><li>可选链就像顾客可能会点，也可能不会点的菜。</li><li>寄存器分配作用域就像厨师的工作台。</li><li>参数就像菜品的配料。</li></ul></li></ul><p>问题出在：当厨房准备可能不会被点的秘方菜（可选链私有方法）时，他们忘记为某些情况准备专门的工作台（寄存器分配作用域）。结果就是，当这道菜真的被点了，而且需要特殊配料（参数）时，厨房乱了套，因为没有适当的工作区域来处理这种情况。</p><h3 id=漏洞实际影响>漏洞实际影响</h3><ul><li>不一致性：这导致字节码生成器（就像厨房的操作流程）在处理资源时出现不一致。</li><li>崩溃风险：在特定情况下，这种不一致可能导致程序崩溃。</li><li>特定场景：这个问题只在使用可选链调用带参数的私有方法时出现，这解释了为什么它在之前可能没被发现。</li><li>难以调试：由于问题发生在引擎内部，对普通开发者来说很难发现和诊断。</li></ul><p>解决方案：</p><p>修复这个问题需要在处理可选链私有方法调用的代码中正确添加寄存器分配作用域。这就像确保厨房在处理每种可能的菜品组合时都有适当的工作区域。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>C</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>C</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>m</span>() { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>; }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>C</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assertEquals</span>(<span style=color:#a6e22e>C</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>m</span>(), <span style=color:#a6e22e>C</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assertEquals</span>((<span style=color:#a6e22e>C</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>m</span>)(), <span style=color:#a6e22e>C</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assertEquals</span>(<span style=color:#a6e22e>C</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>c</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>m</span>(), <span style=color:#a6e22e>C</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>assertEquals</span>((<span style=color:#a6e22e>C</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>c</span><span style=color:#f92672>?</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>m</span>)(), <span style=color:#a6e22e>C</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// assertEquals(C?.#m(42), C);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// assertEquals((C?.#m)(42), C);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// assertEquals(C?.#c?.#m(42), C);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// assertEquals((C?.#c?.#m)(42), C);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>C</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>C</span>);
</span></span></code></pre></div></article></div></div><footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12"><div><p>© 2024 小谢同学的修行小屋</p><p class=text-sm>🌱
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="max-w-[65ch] mt-8 mx-auto px-4"><div><div class="mb-4 text-lg font-medium">关于我</div><div class="prose dark:prose-invert"><p><figure><img src=/resume/profile2.png width=100></figure>一名喜欢RUST的菜鸟程序员</p><h4 id=教育背景研二在读>教育背景（研二在读）</h4><ul><li>2019.09 - 2023.06 天津大学 · 智能与计算学部 · 网络安全专业 · 全日制 · 本科</li><li>2023.09 - 2026.06 天津大学 · 智能与计算学部 · 电子信息专业 · 全日制 · 硕士研究生</li></ul></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">浏览器漏洞挖掘项目</div><div class="prose dark:prose-invert"><p><strong>V8引擎的模糊测试工具改进</strong></p><p>时间：2021.09-2022.04</p><p>内容：聚焦于优化JavaScript引擎的测试方法。研究团队基于SOAT改进部署了V8引擎测试环境，并通过分析测例覆盖率和已知CVE，优化了测试流程。</p><p>成果：成功捕获了一个谷歌引擎的<a href="https://bugs.chromium.org/p/v8/issues/detail?id=12563">逻辑漏洞</a>，获得了修复反馈</p><p><strong>JS引擎WASM模块漏洞挖掘研究</strong></p><p>时间：2023.11-2024.4</p><p>内容：阅读标准手动编写了WASM语法规则，调研了主流JS引擎的WASM支持情况，并基于V8构建了WASM二进制框架。</p><p>成果：<a href=https://github.com/happytraveller-alone/antlr_wat/tree/main/wat_grammar_check_java>语法规则</a>、调研报告和<a href=https://github.com/happytraveller-alone/antlr_wat/tree/main/wasm_domato>二进制构建框架</a>，成功捕获<a href="https://bugs.webkit.org/show_bug.cgi?id=271030">特性缺陷</a>并得到修复</p></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">数据库缺陷研究项目</div><div class="prose dark:prose-invert"><p><strong>关系型数据库缺陷的实证研究</strong></p><p>时间：2022.12-2023.11</p><p>内容：通过构建统一的数据库逻辑框架，系统收集并分析了大量数据库缺陷。对777个缺陷进行了深入分析，特别聚焦SQL数据类型问题，并据此改进了模糊测试方法。</p><p>成果：构建<a href=https://github.com/sqlttest/SQLT/blob/main/dataset.xlsx>缺陷数据集</a>, 开发<a href=https://github.com/sqlttest/SQLT>SQLT测试框架</a>。</p></div></div><div class="divider divider-vertical"></div><div><div class="mb-4 text-lg font-medium">网络协议漏洞挖掘项目</div><div class="prose dark:prose-invert"><p><strong>基于 RFC的 SSL/TLS模糊测试</strong></p><p>时间：2024.4 – today</p><p>内容：梳理TLS协议模糊测试的相关工作，关注基于状态机的网络协议模糊测试方法。复现历史漏洞，了解TLS报文结构，追溯相关漏洞代码。分析RFC文档，提取字段约束，构建状态转移范式，并据此完善了TLS协议的有限状态机模型。</p><p>成果：完成相关工作调研, 漏洞复现报告, <strong>状态范式数据集</strong></p></div></div><div class="divider divider-vertical"></div></div></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=/js/main.min.js></script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script><script defer src=/js/clipboard/clipboard.js></script><link rel=stylesheet href=/css/copy-paste.css></body></html>